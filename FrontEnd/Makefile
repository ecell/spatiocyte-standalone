OPTIONS=-pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -fPIC -I/usr/include/python2.6
LINKS=-pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions

subsystem:
	python ./setup.py build_ext --inplace
	test -d core || mkdir core
	g++ $(OPTIONS) -c ./python/FrontMain.cpp -o core/FrontMain.o
	g++ $(OPTIONS) -c ./python/FrontEndAdapter.cpp -o core/FrontEndAdapter.o
	g++ $(OPTIONS) -c ./python/intermediate/WrapperSystem.cpp -o core/WrapperSystem.o
	g++ $(OPTIONS) -c ./python/intermediate/WrapperVariables.cpp -o core/WrapperVariables.o
	g++ $(OPTIONS) -c ./python/intermediate/WrapperProcess.cpp -o core/WrapperProcess.o
	g++ $(OPTIONS) -c ./python/intermediate/ConvertedModelData.cpp -o core/ConvertedModelData.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Entity.cpp -o core/Entity.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Exceptions.cpp -o core/Exceptions.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/FullID.cpp -o core/FullID.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Model.cpp -o core/Model.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Process.cpp -o core/Process.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Stepper.cpp -o core/Stepper.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/System.cpp -o core/System.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/Variable.cpp -o core/Variable.o
	g++ $(OPTIONS) -c ./ecell3Module/libecs/VariableReference.cpp -o core/VariableReference.o
	g++ $(OPTIONS) -c ./ecell3Module/PeriodicBoundaryDiffusionProcess.cpp -o core/PeriodicBoundaryDiffusionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/MassActionProcess.cpp -o core/MassActionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/VisualizationLogProcess.cpp -o core/VisualizationLogProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/OscillationAnalysisProcess.cpp -o core/OscillationAnalysisProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/SpatiocyteNextReactionProcess.cpp -o core/SpatiocyteNextReactionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/FluorescentProteinImagingProcess.cpp -o core/FluorescentProteinImagingProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/PolymerizationParameterProcess.cpp -o core/PolymerizationParameterProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/DiffusionProcess.cpp -o core/DiffusionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/SpatiocyteStepper.cpp -o core/SpatiocyteStepper.o
	g++ $(OPTIONS) -c ./ecell3Module/PolymerFragmentationProcess.cpp -o core/PolymerFragmentationProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/PolymerizationProcess.cpp -o core/PolymerizationProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/DiffusionInfluencedReactionProcess.cpp -o core/DiffusionInfluencedReactionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/MoleculePopulateProcess.cpp -o core/MoleculePopulateProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/ReactionProcess.cpp -o core/ReactionProcess.o
	g++ $(OPTIONS) -c ./ecell3Module/SpatiocyteProcess.cpp -o core/SpatiocyteProcess.o
	g++ $(LINKS) core/*.o -lgsl -lgslcblas -o ./FrontEndAdapter.so

#	Execute unittest.
check:
	python ./Console.py

#	Link all objects and make so file.
link:
	g++ $(LINKS) core/*.o -lgsl -lgslcblas -o /FrontEndAdapter.so

#	Execute caluculation and output to "putput.eds".
run:
	python ./Console.py -all

#	Execute caluculation without outputting to a file.
calc:
	python ./Console.py -calc

clean:
	#	remove python modules
	rm -f *.pyc
	rm -f ./python/*.pyc

	#	remove C++ object files
	rm -rf build
	cd ecell3Module && $(MAKE) clean
	rm -rf core

	#	remove C++ source and object files generated by cython
	rm -f ./python/FrontEndAdapter.cpp
	rm -f FrontEndAdapter.so

	#	remove output data
	rm -f output.eds
	rm -f *.dat


